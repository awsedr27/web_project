<?xml version="1.0" encoding="UTF-8"?>


<!DOCTYPE mapper
	PUBLIC "-//mybatis.org/DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mapper">


	<!-- 아이템 매퍼 -->

	<select id="getLimitItem"
		resultType="com.webpage.DAO.item.ItemDTO">
		select *from item order by itemId limit 6
	</select>

	<select id="getAjaxItem"
		resultType="com.webpage.DAO.item.ItemDTO" parameterType="int">
		select *from
		item where itemId>#{lastIdNum} order by itemId limit 6
	</select>
		
	<select id="getItemView"
		resultType="com.webpage.DAO.item.ItemDTO" parameterType="int">
		select * from item where itemId=#{itemId}
	</select>
	
	<select id="getCategoryItem"
		resultType="com.webpage.DAO.item.ItemDTO" parameterType="String">
		select *from item where category=#{category} order by itemId limit 6 
		
	</select>
	
	<select id="getCategoryAjaxItem"
		resultType="com.webpage.DAO.item.ItemDTO" parameterType="Map">
		select *from
		item where itemId>#{lastIdNum} and category=#{category} order by itemId limit 6
	</select>
	
	<!-- 회원 매퍼-->
	<select id="setMember" parameterType="com.webpage.DAO.member.MemberDTO">
	INSERT INTO homeshop.memberinfo (`memberId`, `memberPassword`, `birthday`, `phoneNum`, `email`,`houseLocation`) VALUES (#{memberId}, #{memberPassword}, #{birthday}, #{phoneNum}, #{email},#{houseLocation});
	</select>
	
	<select id="getMember"
		resultType="String" parameterType="Map">
		select memberID from memberinfo where memberId=#{memberId} and memberPassword=#{memberPassword}
	</select>
	
	<select id="getMemberInfo"
		resultType="com.webpage.DAO.member.MemberDTO" parameterType="String">
		select * from memberinfo where memberId=#{memberId}
	</select>
	
	<select id="setMyInfoModify"
		 parameterType="com.webpage.DAO.member.MemberDTO">
UPDATE homeshop.memberinfo SET `memberId` = #{memberId}, `birthday` = #{birthday}, `phoneNum` = #{phoneNum}, `email` = #{email}, `houseLocation` = #{houseLocation} WHERE (`memberId` = #{memberId});
	</select>
	
	<select id="checkPassword"
		resultType="Int" parameterType="String">
		select memberPassword from memberinfo where memberId=#{memberId}
	</select>
	
	<select id="setNewPassword"
		 parameterType="Map">
		UPDATE homeshop.memberinfo SET memberPassword = #{newPassword} WHERE (memberId = #{memberId});

	</select>
	
		<!-- 아이템뷰에 리뷰-->
		<select id="getWriteReviewBtn" parameterType="Map" resultType="com.webpage.DAO.review.ReviewDTO">
		select * from review where memberId=#{memberId} and itemId=#{itemId}
		</select>
		
    <select id="getReview"
		resultType="com.webpage.DAO.review.ReviewDTO" parameterType="int">
		select * from review where itemId=#{itemId}
	</select>
	<insert id="setReview" parameterType="com.webpage.DAO.review.ReviewDTO">
	INSERT INTO homeshop.review (`memberId`, `itemId`, `contents`, `rating`, `reviewTime`) VALUES (#{memberId},#{itemId},#{contents},#{rating},#{reviewTime});
	
	</insert>
	
	<!-- 장바구니 -->
	
	<select id="getAjaxCart"
		resultType="com.webpage.DAO.cart.CartDTO" parameterType="String">
		select * from cart where memberId=#{memberId}
	</select>

	<select id="setCart"
	parameterType="com.webpage.DAO.cart.CartDTO">
	INSERT INTO homeshop.cart (`memberId`, `itemId`, `itemUrl`, `itemName`,
	`itemPrice`, `discountNum`, `discount`, `popularity`, `category`)
	VALUES (#{memberId}, #{itemId}, #{itemUrl}, #{itemName}, #{itemPrice}, #{discountNum}, #{discount},#{popularity},#{category});

    </select>
	
	<select id="deleteCart"
		 parameterType="Map">
		DELETE FROM homeshop.cart WHERE (memberId =#{memberId}) and (itemId =#{itemId});
	</select>
	
	<!-- 게시판  -->
	<select id="getBbs"
		resultType="com.webpage.DAO.bbs.BbsDTO" parameterType="Int">
		select *from bbs order by bbsId DESC limit #{bbsNum},10
	</select>
	
	<select id="getPageCnt"
		resultType="Int">
		select count(*)from bbs
	</select>
	
	<select id="setBbs"
		 parameterType="com.webpage.DAO.bbs.BbsDTO">
		 INSERT INTO homeshop.bbs
(memberId, bbsId, bbsTitle, bbsTime, bbsContents)
values (${memberId},(select ifnull(max(bbsId)+1,1)from bbs as b),'${bbsTitle}','${bbsTime}','${bbsContents}');

	</select>
	
	<select id="getBbsView"
		resultType="com.webpage.DAO.bbs.BbsDTO" parameterType="Int">
		select * from bbs where bbsId=#{bbsId}
	</select>
	
	<select id="setBbsModify"
		 parameterType="Map">
UPDATE homeshop.bbs SET bbsTitle = #{bbsTitle},bbsContents=#{bbsContents} WHERE (bbsId = #{bbsId});
	</select>
	
	<select id="deleteBbs"
		 parameterType="Int">
		DELETE FROM homeshop.bbs WHERE (bbsId = #{bbsId});

	</select>
	
<!-- 주문  -->
	<insert id="setOrderInfo"
		parameterType="com.webpage.DAO.orderInfo.OrderInfoDTO">
		INSERT INTO homeshop.orderInfo
		(orderId,memberId,orderName,orderLocation,orderRecipient,orderRequest)
		values ((select ifnull(max(orderId)+1,1)from orderInfo as
		o),#{memberId},#{orderName},#{orderLocation},#{orderRecipient},#{orderRequest});

	</insert>
	<select id="getOrderId" resultType="Int">
	select max(orderId)from orderInfo; 
	</select>
	
	<select id="getOrderInfo" resultType="com.webpage.DAO.orderInfo.OrderInfoDTO">
	select *from orderInfo; 
	</select>
	
	<insert id="setOrderItem"
		parameterType="com.webpage.DAO.orderItem.OrderItemDTO">
		INSERT INTO homeshop.orderItem
		(orderId, memberId, itemId, itemName,
		itemPrice,discountNum,discount,orderItemIndex)
		values (#{orderId},#{memberId},#{itemId},#{itemName},#{itemPrice},#{discountNum},#{discount},(select ifnull(max(orderItemIndex)+1,1)from orderItem as
		oi));

	</insert>
	
	
</mapper>